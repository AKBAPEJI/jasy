#!/usr/bin/env python3

# Extend PYTHONPATH with 'lib'
import sys, os
sys.path.insert(0, os.path.normpath(os.path.join(os.path.dirname(os.path.abspath(sys.argv[0])), os.pardir, "lib")))

# Import JavaScript tooling
from api import *
import time

start = time.time()

# Application specific code
session = JsSession()
session.addProject(JsProject("/Users/Sebastian/Workspace/qooxdoo.unify/qooxdoo/framework"))
session.addProject(JsProject("/Users/Sebastian/Workspace/qooxdoo.unify/qooxdoo/component/apiviewer"))

# Resolving dependencies
print("Resolving dependencies...")
resolver = JsResolver(session)
#resolver.addClassName("qx.core.Object")
resolver.addClassName("qx.ui.window.Window")
classes = resolver.getIncludedClasses()

# Sorting classes
print("Sorting classes...")
sortedClasses = resolver.getSortedClasses()

# Compiling classes
print("Compiling classes...")
compiler = JsCompiler(session, sortedClasses)
result = compiler.compile()

# Debug
print("Runtime: %ims" % ((time.time()-start)*1000))



# Close session
session.close()