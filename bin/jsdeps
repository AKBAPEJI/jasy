#!/usr/bin/env python3

import sys, os, logging

logging.basicConfig(level=logging.DEBUG, format="%(levelname)s: %(message)s")

# Extend PYTHONPATH with 'lib'
sys.path.insert(0, os.path.normpath(os.path.join(os.path.dirname(os.path.abspath(sys.argv[0])), os.pardir, "lib")))

from js.parser.Parser import parse
from js.Variables import scan

def jsdeps(source, filename=None):
    root = parse(source, filename)
    stats = scan(root)
    
    for name in sorted(stats.modifiedObjects):
        print("Exports Object: %s" % name)

    for name in sorted(stats.modified):
        print("Exports Variable: %s" % name)

    for name in sorted(stats.shared):
        print("Uses Global: %s" % name)

    for name in sorted(stats.accessedObjects):
        print("Uses Object: %s" % name)


if __name__ == "__main__":
    jsdeps(open(sys.argv[1], encoding="utf-8").read(), sys.argv[1])
